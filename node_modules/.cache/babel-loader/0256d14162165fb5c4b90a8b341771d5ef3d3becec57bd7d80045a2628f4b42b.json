{"ast":null,"code":"import React,{useContext,useEffect,useState}from'react';import{formatTime}from'./../../Formater/formatTime';import{Link}from'react-router-dom';import errorPicture from'../../images/error.png';import{currentUserContext,gameSettingsContext,leaderDashboardContext}from'../../contexts/Context';import TimerButton from'./TimerButton';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const GameTimer=()=>{const gameContext=useContext(gameSettingsContext);const leaderDashboard=useContext(leaderDashboardContext);const[seconds,setSeconds]=useState(gameContext.gameSettings.gameTime);const winner=gameContext.gameSettings.winner;const flags=gameContext.gameSettings.flags;const mines=gameContext.gameSettings.mines;const gameStart=gameContext.gameSettings.gameStart;const setWin=gameContext.gameSettings.setWin;const currentUser=useContext(currentUserContext);useEffect(()=>{const interval=setInterval(()=>{if(seconds>0&&winner===null&&gameStart){setSeconds(prevSeconds=>prevSeconds-1);}if(seconds===0&&gameContext.gameSettings.winner!==false){gameContext.setGameSettings({...gameContext.gameSettings,winner:false});}},1000);return()=>{clearInterval(interval);};});useEffect(()=>{if(winner===true&&!setWin){let userRecord=JSON.parse(localStorage.getItem('leaderDashboard'));console.log(userRecord);const updatedUserRecord=userRecord.map(user=>{if(user.id===currentUser.user.id&&user.timeEasy<seconds){if(gameContext.gameSettings.level===1){return{...user,timeEasy:seconds};}else if(gameContext.gameSettings.level===2&&user.timeMid<seconds){return{...user,timeMid:seconds};}else if(gameContext.gameSettings.level===3&&user.timeHard<seconds){return{...user,timeHard:seconds};}}return user;});leaderDashboard.setLeaderDashboard(updatedUserRecord);localStorage.setItem('leaderDashboard',JSON.stringify(updatedUserRecord));gameContext.setGameSettings({...gameContext.gameSettings,setWin:true});}});if(seconds===undefined||mines===undefined||flags===undefined){return/*#__PURE__*/_jsxs(\"div\",{className:\"game-timer__error\",children:[/*#__PURE__*/_jsx(\"img\",{src:errorPicture,className:\"error-picture\",alt:\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430!\"}),/*#__PURE__*/_jsx(\"h1\",{children:\"\\u041E\\u0439! \\u0427\\u0442\\u043E-\\u0442\\u043E \\u043F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u043E \\u043D\\u0435 \\u0442\\u0430\\u043A!\"}),/*#__PURE__*/_jsx(Link,{to:\"/\",children:\"\\u0412\\u0435\\u0440\\u043D\\u0443\\u0442\\u044C\\u0441\\u044F \\u043D\\u0430\\u0437\\u0430\\u0434\"})]});}else{return/*#__PURE__*/_jsxs(\"div\",{className:\"game-timer\",children:[winner===false||winner===null?/*#__PURE__*/_jsx(\"h2\",{className:winner===null?'game-board__winner-null':'game-board__winner-lose',children:\"\\u0412\\u044B \\u043F\\u0440\\u043E\\u0438\\u0433\\u0440\\u0430\\u043B\\u0438!\"}):/*#__PURE__*/_jsx(\"h2\",{className:\"game-board__winner-win\",children:\"\\u0412\\u044B \\u043F\\u043E\\u0431\\u0435\\u0434\\u0438\\u043B\\u0438!\"}),/*#__PURE__*/_jsx(\"h1\",{children:formatTime(seconds)}),winner===false||winner===true?/*#__PURE__*/_jsx(TimerButton,{onClick:()=>{gameContext.setGameSettings({rows:0,columns:0,winner:null,gameTime:0,mines:0,flags:0,level:0,gameStart:false,setWin:false});}}):/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\u041E\\u0441\\u0442\\u0430\\u043B\\u043E\\u0441\\u044C \\u0444\\u043B\\u0430\\u0436\\u043A\\u043E\\u0432: \",flags.toString().padStart(2,'0')]})]});}};export default GameTimer;","map":{"version":3,"names":["React","useContext","useEffect","useState","formatTime","Link","errorPicture","currentUserContext","gameSettingsContext","leaderDashboardContext","TimerButton","jsx","_jsx","jsxs","_jsxs","GameTimer","gameContext","leaderDashboard","seconds","setSeconds","gameSettings","gameTime","winner","flags","mines","gameStart","setWin","currentUser","interval","setInterval","prevSeconds","setGameSettings","clearInterval","userRecord","JSON","parse","localStorage","getItem","console","log","updatedUserRecord","map","user","id","timeEasy","level","timeMid","timeHard","setLeaderDashboard","setItem","stringify","undefined","className","children","src","alt","to","onClick","rows","columns","toString","padStart"],"sources":["C:/Users/bibat/OneDrive/Рабочий стол/Работа/поверстать/saper/src/components/Helpers/GameTimer.jsx"],"sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\r\nimport { formatTime } from './../../Formater/formatTime';\r\nimport { Link } from 'react-router-dom';\r\nimport errorPicture from '../../images/error.png'\r\nimport { currentUserContext, gameSettingsContext, leaderDashboardContext } from '../../contexts/Context';\r\nimport TimerButton from './TimerButton';\r\n\r\nconst GameTimer = () => {\r\n    const gameContext = useContext(gameSettingsContext)\r\n    const leaderDashboard = useContext(leaderDashboardContext)\r\n    const [seconds, setSeconds] = useState(gameContext.gameSettings.gameTime);\r\n    const winner = gameContext.gameSettings.winner\r\n    const flags = gameContext.gameSettings.flags\r\n    const mines = gameContext.gameSettings.mines\r\n    const gameStart = gameContext.gameSettings.gameStart\r\n    const setWin = gameContext.gameSettings.setWin\r\n    const currentUser = useContext(currentUserContext)\r\n\r\n    useEffect(() => {\r\n        const interval = setInterval(() => {\r\n            if (seconds > 0 && winner === null && gameStart) {\r\n                setSeconds(prevSeconds => prevSeconds - 1);\r\n            }\r\n            if (seconds === 0 && gameContext.gameSettings.winner !== false) {\r\n                gameContext.setGameSettings({\r\n                    ...gameContext.gameSettings, winner: false\r\n                })\r\n            }\r\n        }, 1000);\r\n        return () => {\r\n            clearInterval(interval);\r\n        };\r\n    });\r\n    useEffect(() => {\r\n        if (winner === true && !setWin) {\r\n            let userRecord = JSON.parse(localStorage.getItem('leaderDashboard'));\r\n            console.log(userRecord);\r\n            const updatedUserRecord = userRecord.map(user => {\r\n            if (user.id === currentUser.user.id && user.timeEasy < seconds) {\r\n                if (gameContext.gameSettings.level === 1) {\r\n                    return {...user, timeEasy: seconds};\r\n                } else if (gameContext.gameSettings.level === 2 && user.timeMid < seconds) {\r\n                    return {...user, timeMid: seconds};\r\n                } else if (gameContext.gameSettings.level === 3 && user.timeHard < seconds) {\r\n                    return {...user, timeHard: seconds};\r\n                }\r\n            }\r\n            return user;\r\n            });\r\n            leaderDashboard.setLeaderDashboard(updatedUserRecord)\r\n            localStorage.setItem('leaderDashboard', JSON.stringify(updatedUserRecord));\r\n            gameContext.setGameSettings({\r\n                ...gameContext.gameSettings, setWin: true\r\n            })\r\n        }\r\n    })\r\n\r\n    if (seconds === undefined || mines === undefined || flags === undefined) {\r\n        return (\r\n            <div className=\"game-timer__error\">\r\n                <img src={errorPicture} className='error-picture' alt='Ошибка!'/>\r\n                <h1>Ой! Что-то произошло не так!</h1>\r\n                <Link to='/'>Вернуться назад</Link>\r\n            </div>\r\n        );\r\n    }\r\n    else {\r\n        return (\r\n            <div className='game-timer'>\r\n                {winner === false || winner === null ?\r\n                    <h2 className={winner === null ? 'game-board__winner-null' : 'game-board__winner-lose'}>Вы проиграли!</h2> \r\n                    :\r\n                    <h2 className='game-board__winner-win'>Вы победили!</h2>}\r\n                <h1>{formatTime(seconds)}</h1>\r\n                {winner === false || winner === true ?\r\n                    <TimerButton onClick={() => {\r\n                        gameContext.setGameSettings({\r\n                            rows: 0,\r\n                            columns: 0,\r\n                            winner: null,\r\n                            gameTime: 0,\r\n                            mines: 0,\r\n                            flags: 0,\r\n                            level: 0,\r\n                            gameStart: false,\r\n                            setWin: false\r\n                        })\r\n                    }}/> :\r\n                    <h2>Осталось флажков: {flags.toString().padStart(2, '0')}</h2>\r\n                }\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default GameTimer;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}